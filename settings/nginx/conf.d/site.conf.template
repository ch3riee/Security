server {

    listen 80 ;

    #proxy_redirect   off;
    proxy_set_header Host              $http_host;
    proxy_set_header X-Real-IP         $remote_addr;
    proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    #Web Section
    #This section contains a sample application for web users

    location ~ /rest/login/* {
            proxy_pass            http://srvjavausers:8081 ;
        }

    location ~ /rest/(?<j_uri>.*)$ {
            if ($http_cookie !~ "JwtToken=") {
               return 302 $scheme://$host:8080/rest/login?j_uri=/rest/$j_uri ;
            }
            proxy_pass            http://srvjavausers:8081 ;
        }

    #Please add microservices below this line
    #############################################################
    location ~ /sample/* {
            if ($http_cookie !~ "JwtToken=") {
               return 302 $scheme://$host:8080/rest/login ;
            }
            proxy_pass            http://srv-sample:8000 ;
        }


    #Internal Section
    #This section contains all the APIs provided to microservices to use

    location ~ /rest/session/* {
        if ($http_authorization = ""){
           return 403 ;
        }
        proxy_pass            http://srvjavausers:8081 ;
    }

    #Please add all internal services below this line
    ############################################################


    #Static Content Section
    #This section contains an example on serving static content
    location  / {
        alias /var/lib/static/ ;
        index index.html ;
    }

    #Please add all static content below this line
    ###########################################################


}